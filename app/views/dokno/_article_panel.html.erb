<!-- Dokno Slide-out Panel                                                                            -->
<!-- This file is injected into the host layout when included via `render 'dokno/article_panel'`      -->
<!-- in the host app's app/views/layouts/application.html.erb to provide support for slide-out        -->
<!-- article panels with `dokno_article_modal({link-text}, slug: {article-slug})`                     -->

<!-- Slide-out panel styles -->
<style>
  div#dokno-panel-container {
    right: -600px;
    z-index: 9999;
    position: fixed;
    top: 0;
    bottom: 0;
    width: 600px;
    max-width: 100vw;
    overflow: hidden;
    overflow-y: auto;
    background-color: #fff;
    color: #2d3748;
    transition: all .15s ease-in-out;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  div#dokno-panel-container.open {
    right: 0;
  }

  a#dokno-panel-close {
    position: absolute;
    top: 2.4rem;
    right: 2.5rem;
    display: inline-block;
    color: #fff;
    font-weight: bold;
    font-size: 200%;
    text-decoration: none;
  }

  div#dokno-panel-title {
    padding: 2.5rem;
    font-size: 170%;
    font-weight: 600;
    background-color: #22543d;
    color: #ebf8ff;
  }

  div#dokno-panel-title > span,
  div#dokno-panel-footer > svg {
    cursor: pointer;
  }

  div#dokno-panel-summary {
    line-height: 1.5;
    padding: 2.5rem;
    font-size: 140%;
  }

  div#dokno-panel-markdown {
    line-height: 1.5;
    padding: 2.5rem;
    font-size: 110%;
    background-color: #f7fafc;
  }

  div#dokno-panel-markdown p,
  div#dokno-panel-footer p {
    margin: 0 15px 15px 0;
  }

  div#dokno-panel-footer {
    text-align: center;
    position: relative;
    padding: 2.5rem;
    color: #999;
    background-color: #edf2f7;
  }

  div#dokno-panel-footer > svg {
    position: absolute;
    top: -12px;
    left: 274px;
  }
</style>

<!-- Slide-out panel markup -->
<div id="dokno-panel-container">
  <a id="dokno-panel-close" href="javascript:;" title="Close panel" onclick="doknoClosePanel();">&rarr;</a>

  <div id="dokno-panel-title"></div>
  <div id="dokno-panel-summary"></div>
  <div id="dokno-panel-markdown"></div>
  <div id="dokno-panel-footer"></div>
</div>

<!-- Slide-out panel behavior -->
<script>
  function doknoOpenPanel(slug) {
    // Can't use fetch API since unsupported in IE
    const request = new XMLHttpRequest();
    request.open('GET', '/dokno/article_panel/' + slug, true);
    request.onload = function() {
      if (request.readyState == 4 && request.status == 200) {
        try {
          var data = JSON.parse(request.responseText);
        } catch(err) {
          console.log(err.message + " in " + request.responseText);
          return;
        }

        dokno__id = data.id;
        document.getElementById('dokno-panel-title').innerHTML = data.title;
        document.getElementById('dokno-panel-summary').innerHTML = data.summary;
        document.getElementById('dokno-panel-markdown').innerHTML = data.markdown;
        document.getElementById('dokno-panel-footer').innerHTML = data.footer;

        var
          title_span = document.querySelector('div#dokno-panel-title > span'),
          icon_svg   = document.querySelector('div#dokno-panel-footer > svg');

        title_span.setAttribute('title', 'Open full article page');
        title_span.onclick = function() { window.open('/dokno/articles/' + dokno__id); }
        icon_svg.onclick   = function() { window.open('/dokno'); }

        dokno__panel.scrollTop = 0;
        dokno__panel.classList.add('open');
      }
    };

    request.send();
  }

  function doknoClosePanel() {
    dokno__panel.classList.remove('open');
  }

  const dokno__panel = document.getElementById('dokno-panel-container');
  var dokno__id;
</script>